<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TinyImageLoader: Example: Setting the pitch when loading</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TinyImageLoader&#160;<span id="projectnumber">1.7.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Example: Setting the pitch when loading </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>This example shows you how you can use TinyImageLoader to load images with a specified width and height.</p>
<p>Refer to <a class="el" href="example1.html">Example: Loading an OpenGL texture</a> for an example of how to load an image the normal way.</p>
<p>If no pitch function has been set, the horizontal and vertical pitch are identical to the width and height, respectively.</p>
<h2><a class="anchor" id="intro"></a>
Introduction</h2>
<p>Sometimes, you might need a specific width and height to your images. For instance, some graphics cards only support textures that have a width and height that is a power of two (16, 32, 64, 128, etc.) It can be a pain to load an image, rearrange the pixel data and upload it to the videocard.</p>
<p>With TinyImageLoader, you can convert the image to the correct bit depth and set the pitch while you're loading it. You do this by attaching a pitch function.</p>
<h2><a class="anchor" id="writing"></a>
Writing a pitch function</h2>
<p>Your function will receive the following parameters:</p>
<ul>
<li>Real width of the image</li>
<li>Real height of the image</li>
<li>Amount of bytes per pixel</li>
<li>Target horizontal pitch</li>
<li>Target vertical pitch</li>
</ul>
<p>Your function will set the horizontal pitch and the vertical pitch. If either of the pitches is smaller than the actual width or height of the image, TinyImageLoader will post an error and loading the image will be cancelled.</p>
<p>Here we will write a pitch function that returns the width and height as a power of two:</p>
<div class="fragment"><pre class="fragment">        <span class="keywordtype">void</span> CustomPitchFunc(<a class="code" href="namespacetil.html#a20db61688ed403d11f057a508d87e54c" title="32-bit unsigned integer">til::uint32</a> a_Width, <a class="code" href="namespacetil.html#a20db61688ed403d11f057a508d87e54c" title="32-bit unsigned integer">til::uint32</a> a_Height, <a class="code" href="namespacetil.html#a7a75b0e7e2cd3f19ea51c8c02fd242f8" title="8-bit unsigned integer">til::uint8</a> a_BPP, <a class="code" href="namespacetil.html#a20db61688ed403d11f057a508d87e54c" title="32-bit unsigned integer">til::uint32</a>&amp; a_PitchX, <a class="code" href="namespacetil.html#a20db61688ed403d11f057a508d87e54c" title="32-bit unsigned integer">til::uint32</a>&amp; a_PitchY)
        {
            <span class="comment">// determine which is greater</span>
                <a class="code" href="namespacetil.html#a20db61688ed403d11f057a508d87e54c" title="32-bit unsigned integer">til::uint32</a> high = (a_Width &gt; a_Height) ? a_Width : a_Height;

                <span class="comment">// find the closest power of two</span>
                <a class="code" href="namespacetil.html#a20db61688ed403d11f057a508d87e54c" title="32-bit unsigned integer">til::uint32</a> closest = 0;
                <a class="code" href="namespacetil.html#a20db61688ed403d11f057a508d87e54c" title="32-bit unsigned integer">til::uint32</a> move = high;
                <span class="keywordflow">while</span> (move &gt;&gt;= 1) { closest++; }
                <span class="keywordflow">if</span> (high - (1 &lt;&lt; closest) &gt; 0) { closest++; }

                <span class="comment">// shift by the found number of bits</span>
                a_PitchX = 1 &lt;&lt; closest;
                a_PitchY = a_PitchX;
        }
</pre></div><p>Then we attach the function to TinyImageLoader:</p>
<div class="fragment"><pre class="fragment">        <a class="code" href="namespacetil.html#a9fe7da11935463fefdaf5c63ca24aa4e" title="Set the pitch function to be used internally.">til::TIL_SetPitchFunc</a>(CustomPitchFunc);
</pre></div><h2><a class="anchor" id="loading"></a>
Loading a file</h2>
<p>There's one thing that still needs to be changed: instead of using GetWidth and GetHeight on the image handle, we must now use GetPitchX and GetPitchY to get the correct dimensions.</p>
<div class="fragment"><pre class="fragment">        glTexImage2D(
                GL_TEXTURE_2D, 0, GL_RGBA,
                g_Load-&gt;GetPitchX(i), g_Load-&gt;GetPitchY(i),
                0,
                GL_RGBA, GL_UNSIGNED_BYTE, g_Load-&gt;GetPixels(i)
        );
</pre></div> </div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu May 26 2011 17:59:14 for TinyImageLoader by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
