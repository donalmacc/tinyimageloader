<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>TinyImageLoader: Example: Loading an OpenGL texture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TinyImageLoader&#160;<span id="projectnumber">1.7.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Example: Loading an OpenGL texture </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>This example will show you how to load an image using TinyImageLoader and use it as a texture.</p>
<h2><a class="anchor" id="intro"></a>
Introduction</h2>
<p>When you drag an image onto the exe created by this example, TinyImageLoader will try to load it. If the file cannot be loaded (for whatever the reason), you can check the til.log located at in /examples/bin/til.log. If you find an image that doesn't load, please send it and the log to me! I will get back to you as soon as possible with (hopefully) a fix and (always) an apology.</p>
<h2><a class="anchor" id="input"></a>
Key binding</h2>
<p>Use the following keys in this example:</p>
<ul>
<li>Right Arrow Key: Go to the next frame (if it exists)</li>
<li>Left Arrow Key: Go to the previous frame (if it exists)</li>
<li>Up Arrow Key: Zoom in on the image</li>
<li>Down Arrow Key: Zoom out on the image</li>
</ul>
<h2><a class="anchor" id="setup"></a>
Setup</h2>
<p>There are a couple of things you need to do before you can start using TinyImageLoader. First, you need to compile the TinyImageLoader static library using Visual Studio. Then you can copy the SDK folder to a project. Here's how I set up my projects:</p>
<ul>
<li>\ (project root)<ul>
<li>bin (output directory)<ul>
<li>Project.exe (Release build)</li>
<li>Project_d.exe (Debug build)</li>
</ul>
</li>
<li>int (intermediate directory)<ul>
<li>Debug</li>
<li>Release</li>
</ul>
</li>
<li>lib (third-party libraries)<ul>
<li>TinyImageLoader<ul>
<li>TinyImageLoader.lib</li>
<li>TinyImageLoader_d.lib</li>
<li>headers</li>
</ul>
</li>
</ul>
</li>
<li>src (project source files)</li>
<li>Project.vcproj</li>
<li>Solution.sln</li>
</ul>
</li>
</ul>
<p>You are free to set these things as you like, of course, but this is how I prefer it. :)</p>
<p>You can compile TinyImageLoader for three levels: <b>release</b>, <b>debug</b> and <b>devel</b>. Devel is the same as debug, except that it posts messages to the debug callback. Debug does not post these messages. It is avised to always compile your program with either the debug or the release version of TinyImageLoader. Devel is only for developers of TinyImageLoader.</p>
<h2><a class="anchor" id="startup"></a>
Setting up TinyImageLoader</h2>
<p>The first thing we need to do is initialize TinyImageLoader. </p>
<div class="fragment"><pre class="fragment">        <a class="code" href="namespacetil.html#a84a20b430c5ae27956968ef6d7a6425b" title="Initializes TinyImageLoader.">til::TIL_Init</a>();
</pre></div><h2><a class="anchor" id="logging"></a>
Logging</h2>
<p>By default, TinyImageLoader posts its errors and warning to an internal expanding string. This may not be desirable, as it takes memory you don't have any control over. Therefor, TinyImageLoader comes with a series of callbacks you can use to control the logging behavior.</p>
<p>In this example we will output all debug and error messages to a log.</p>
<p>We open our log by using a TinyImageLoader function to attach the working directory.</p>
<div class="fragment"><pre class="fragment">        g_LogPath = <span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="_t_i_l_settings_8h.html#aa7da87a80d18c2e139c10d0a6a982286">TIL_MAX_PATH</a>];
        <a class="code" href="namespacetil.html#a0a78aac0d1be8f1403da0a7eff6334ca" title="Adds working directory to a path.">til::TIL_AddWorkingDirectory</a>(g_LogPath, <a class="code" href="_t_i_l_settings_8h.html#aa7da87a80d18c2e139c10d0a6a982286">TIL_MAX_PATH</a>, <span class="stringliteral">&quot;til.log&quot;</span>);
        fopen_s(&amp;g_Log, g_LogPath, <span class="stringliteral">&quot;w+&quot;</span>);
        fclose(g_Log);
</pre></div><p>We open it only to clear it. If it doesn't exist it gets created.</p>
<p>We have a custom logging function, that outputs the message to the log we just created.</p>
<div class="fragment"><pre class="fragment">        <span class="keywordtype">void</span> LoggingFunc(<a class="code" href="structtil_1_1_message_data.html" title="Message structure.">til::MessageData</a>* a_Data)
        {
                fopen_s(&amp;g_Log, g_LogPath, <span class="stringliteral">&quot;a&quot;</span>);
                <span class="keywordtype">char</span> msg[1024];
                sprintf_s(msg, 1024, <span class="stringliteral">&quot;%s\n&quot;</span>, a_Data-&gt;<a class="code" href="structtil_1_1_message_data.html#a509ca54f8bbc534d0220d3e7b1637a8d">message</a>);
                fputs(msg, g_Log);
                fclose(g_Log);
        }
</pre></div><p>Of course, we will need to attach this function to TinyImageLoader using the callback register functions.</p>
<div class="fragment"><pre class="fragment">        <a class="code" href="namespacetil.html#a4e9b5c8b33ec4ec38e7ef895a8eac58e" title="Set the callback for the internal debug logging function.">til::TIL_SetDebugFunc</a>(LoggingFunc);
        <a class="code" href="namespacetil.html#acf5fe389d33053c01da96da10ef88b0e" title="Set the callback for the internal error logging function.">til::TIL_SetErrorFunc</a>(LoggingFunc);
</pre></div><h2><a class="anchor" id="setupopengl"></a>
Setting up OpenGL</h2>
<p>For this example we only want to display an image on the screen. We don't want any of the fancypants functionality OpenGL provides.</p>
<div class="fragment"><pre class="fragment">        glMatrixMode(GL_PROJECTION);
                glLoadIdentity();
                glOrtho(0, s_WindowWidth, s_WindowHeight, 0, -1, 1);
        glMatrixMode(GL_MODELVIEW);
                glLoadIdentity();
        glClearColor(0.f, 0.f, 0.f, 0.f);
        <span class="comment">// Make sure the quads show up</span>
        glDisable(GL_DEPTH_TEST);
        glDisable(GL_CULL_FACE);
</pre></div><p>We disable the depth test and backface culling because I'm a busy man who can't be bothered to check the winding of his vertices.</p>
<h2><a class="anchor" id="loading"></a>
Loading a file</h2>
<p>Now we are ready to load a file. We are going to load an image as an OpenGL texture with an alpha component, so we are using the OpenGL color format GL_RGBA while we are using the TinyImageLoader format <a class="el" href="_t_i_l_settings_8h.html#aa41c714a49a57e84fe823a09e898c074" title="32-bit ABGR color depth">TIL_DEPTH_A8B8G8R8</a>. This is because TinyImageLoader uses big-endianness for its color components, while OpenGL prefers little-endianness. The data remains the same, it's just the order that is different.</p>
<p>If a file has been dragged onto the executable, TinyImageLoader tries to load it. Otherwise it loads an image verified to work.</p>
<div class="fragment"><pre class="fragment">        <span class="keywordflow">if</span> (a_Commands == 1)
        {
                g_Load = <a class="code" href="namespacetil.html#a8d2e2ab942bb94b188587509ccb754de" title="Main interface for loading images.">til::TIL_Load</a>(<span class="stringliteral">&quot;media\\PNG\\avatar.png&quot;</span>, <a class="code" href="_t_i_l_settings_8h.html#a46033ff709c68056a163fefecfae188a" title="The image path is relative to the working directory.">TIL_FILE_ADDWORKINGDIR</a> | <a class="code" href="_t_i_l_settings_8h.html#aa41c714a49a57e84fe823a09e898c074" title="32-bit ABGR color depth">TIL_DEPTH_A8B8G8R8</a>);
        }
        <span class="keywordflow">else</span>
        {
                g_Load = <a class="code" href="namespacetil.html#a8d2e2ab942bb94b188587509ccb754de" title="Main interface for loading images.">til::TIL_Load</a>(a_CommandLine[1], <a class="code" href="_t_i_l_settings_8h.html#a35df91f5e83de2ea6177f37406e487d9" title="The image path is absolute.">TIL_FILE_ABSOLUTEPATH</a> | <a class="code" href="_t_i_l_settings_8h.html#aa41c714a49a57e84fe823a09e898c074" title="32-bit ABGR color depth">TIL_DEPTH_A8B8G8R8</a>);
        }
</pre></div><p>If the file could not be loaded, TIL_Load returns NULL and posts an error message to the log.</p>
<p>You can retrieve the error message in the following manner, if you haven't attached a custom logging function:</p>
<div class="fragment"><pre class="fragment">        <span class="keywordflow">if</span> (!g_Load)
        {
            <span class="keyword">const</span> <span class="keywordtype">char</span>* error_msg = (<span class="keyword">const</span> <span class="keywordtype">char</span>*)<a class="code" href="namespacetil.html#a194b32071f97f5607de361743f895c54" title="Get the errors as a string.">til::TIL_GetError</a>();
            <span class="comment">// print it to the console</span>
            printf(<span class="stringliteral">&quot;%s&quot;</span>, error_msg);
        }
</pre></div><h2><a class="anchor" id="uploading"></a>
Uploading image data to OpenGL</h2>
<p>We now have our image data loaded and converted to the right pixel depth by TinyImageLoader. We are ready to upload the data to OpenGL.</p>
<p>What you have to keep in mind is that not all formats are created equally. Most formats only allow you to define a single image, while others also allow a series of frames (GIF, PNG) and some allow multiple levels of detail (ICO, DDS).</p>
<p>So the first thing we will need to do is determine how many frames our image contains.</p>
<div class="fragment"><pre class="fragment">        g_TextureTotal = g_Load-&gt;GetFrameCount();
        g_Texture = <span class="keyword">new</span> GLuint[g_TextureTotal];
</pre></div><p>If an image is only allowed (according to the spec) to contain 1 frame, GetFrameCount() will always return 1.</p>
<p>Now we can loop over our image data.</p>
<div class="fragment"><pre class="fragment">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; g_TextureTotal; i++)
        {
                glBindTexture(GL_TEXTURE_2D, g_Texture[i]);
                glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
                glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
                glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);
                glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);
                glTexImage2D(
                        GL_TEXTURE_2D, 0, GL_RGBA,
                        g_Load-&gt;GetWidth(i), g_Load-&gt;GetHeight(i),
                        0,
                        GL_RGBA, GL_UNSIGNED_BYTE, g_Load-&gt;GetPixels(i)
                );
        }
</pre></div><p>Success! We now have an OpenGL texture. :)</p>
<h2><a class="anchor" id="render"></a>
Rendering</h2>
<p>We now have everything we need to render an image quad on the screen.</p>
<div class="fragment"><pre class="fragment">        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
        glEnable(GL_BLEND);
        glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

        glBindTexture(GL_TEXTURE_2D, g_Texture[g_TextureCurrent]);

        <span class="comment">// Make sure we don&#39;t screw up our meticulously designed matrices</span>

        glPushMatrix();

                <span class="comment">// Push it to the correct position</span>
                glTranslatef(g_PosX, g_PosY, 0.0f);
                <span class="comment">// Set the image size</span>
                glScalef(g_ScaleX, g_ScaleY, 1.0f);

                <span class="comment">// Draw a quad</span>
                glBegin(GL_QUADS);
                        glTexCoord2f(0.f, 1.f); glVertex2f(0.0f, 1.0f);
                        glTexCoord2f(1.f, 1.f); glVertex2f(1.0f, 1.0f);
                        glTexCoord2f(1.f, 0.f); glVertex2f(1.0f, 0.0f);
                        glTexCoord2f(0.f, 0.f); glVertex2f(0.0f, 0.0f);
                glEnd();

        glPopMatrix();

        glDisable(GL_BLEND);
</pre></div><h2><a class="anchor" id="cleanup"></a>
Cleaning up</h2>
<p>Finally, when we're done, we need to clean up the handles to TinyImageLoader. Keep in mind that you can keep <a class="el" href="classtil_1_1_image.html" title="The virtual interface for loading images and extracting image data.">til::Image</a> pointers around for as long as you need them. Calling <a class="el" href="namespacetil.html#a777e336727a478c4c4bdfd8c0e3603d7" title="Shuts down TinyImageLoader.">til::TIL_ShutDown</a> doesn't affect the validity of the handles, but it cleans up the library.</p>
<div class="fragment"><pre class="fragment">        <a class="code" href="namespacetil.html#a8fd384196869e66fbb9377e720986d6e" title="Releases the handle to a til::Image.">til::TIL_Release</a>(g_Load);

        <a class="code" href="namespacetil.html#a777e336727a478c4c4bdfd8c0e3603d7" title="Shuts down TinyImageLoader.">til::TIL_ShutDown</a>();
</pre></div><h2><a class="anchor" id="code"></a>
Code</h2>
<p>Check out the source for this example at /examples/src/example-opengl-texture.cpp. </p>
</div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Sun Jul 10 2011 14:40:31 for TinyImageLoader by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
